{% extends 'base.html' %}
<!---->
{% load humanize %}
<!---->
{% load static %}
<!---->
{% block title %} | Shopping Cart {% endblock %}
<!---->
{% block content %}
<!---->
<style>
  .cart-item-container {
    border-bottom: 1px solid #eee;
    padding: 15px 0;
  }
  .cart-item-image {
    width: 100px;
    height: 100px;
    object-fit: cover;
    margin-right: 15px;
    float: left;
  }
  .cart-item-content {
    float: left;
    width: calc(100% - 250px);
  }
  .title {
    font-weight: bold;
    font-size: 1.1em;
    margin-bottom: 5px;
  }
  .variation {
    color: #666;
    font-size: 0.9em;
  }
  .price-details {
    margin-top: 10px;
    font-weight: 500;
  }
  .remove-section {
    float: right;
    text-align: right;
    width: 100px;
  }
  .quantity-control {
    margin-top: 10px;
  }
  .clear {
    clear: both;
  }
</style>

<div class="container py-5">
  <h2 class="mb-4">您的購物車</h2>

  {% if cart_items %}
  <div class="row">
    <div class="col-md-8">
      <div class="cart-items shadow-sm p-3 bg-white rounded">
        {% for item in cart_items %}
        <div class="cart-item-container">
          <div class="cart-item">
            <a href="{% url 'products:product_detail' item.product.id %}">
              {% if item.product.image_00 %}
              <img
                class="cart-item-image rounded"
                src="{{ item.product.image_00.url }}"
                alt="{{ item.product.title }}"
              />
              {% else %}
              <img
                class="cart-item-image rounded"
                src="{% static 'img/no_image.png' %}"
                alt="No Image"
              />
              {% endif %}
            </a>

            <div class="cart-item-content">
              <div class="wrap--bundle-title-variation">
                <div class="title text-primary">{{ item.product.title }}</div>

                <div class="item-variation">
                  <div class="variation">
                    <strong>尺寸:</strong> {{ item.size|default:"Standard" }}
                  </div>
                </div>

                <div class="quantity-control">
                  <form
                    action="{% url 'carts:update_cart_item' item.id %}"
                    method="POST"
                    class="d-inline"
                  >
                    {% csrf_token %}
                    <div
                      class="input-group input-group-sm"
                      style="width: 120px"
                    >
                      <div class="input-group-prepend">
                        <button
                          name="action"
                          value="decrease"
                          class="btn btn-outline-secondary"
                        >
                          -
                        </button>
                      </div>
                      <input
                        type="text"
                        class="form-control text-center"
                        value="{{ item.quantity }}"
                        readonly
                      />
                      <div class="input-group-append">
                        <button
                          name="action"
                          value="increase"
                          class="btn btn-outline-secondary"
                        >
                          +
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>

              <div class="price-details">
                {{ item.quantity }} <span style="margin: 0 3px">x</span>
                <span class="text-dark"
                  >HK${{ item.product.price|intcomma }}</span
                >
              </div>
            </div>

            <div class="remove-section">
              <div class="mb-2 font-weight-bold"></div>
              <div class="mb-3 text-danger font-weight-bold">
                HK${{ item.get_subtotal|intcomma }}
              </div>
              <a
                href="{% url 'carts:remove_from_cart' item.id %}"
                class="text-muted small"
                onclick="return confirm('確定要從購物車移除嗎？');"
              >
                <i class="fa fa-trash"></i> 刪除
              </a>
            </div>
            <div class="clear"></div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title font-weight-bold">訂單摘要</h5>
          <hr />
          <div class="d-flex justify-content-between mb-3">
            <span>商品總計</span>
            <span class="font-weight-bold">HK${{ total_price|intcomma }}</span>
          </div>
          <button
            class="btn btn-block text-white"
            style="
              background-color: #ffb7b7ff;
              border: none;
              height: 50px;
              font-weight: bold;
            "
          >
            訂單結帳
          </button>
          <a
            href="{% url 'products:index' %}"
            class="btn btn-link btn-block btn-sm text-muted mt-2"
            >繼續購物</a
          >
        </div>
      </div>
    </div>
  </div>
  {% else %}
  <div class="text-center py-5 shadow-sm bg-white rounded">
    <i class="fa fa-shopping-basket fa-4x text-light mb-4"></i>
    <h4 class="text-muted">你的購物車是空的</h4>
    <div class="mt-4">
      <a
        href="{% url 'products:index' %}"
        class="btn px-5 text-white"
        style="background-color: #ffb7b7ff"
        >立即去購物</a
      >
    </div>
  </div>
  {% endif %}
</div>

<div class="clear"></div>
{% endblock %}
